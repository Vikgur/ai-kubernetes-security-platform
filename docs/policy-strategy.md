# Оглавление

- [Назначение Policy Strategy](#назначение-policy-strategy)  
- [Базовый принцип](#базовый-принцип)  
- [Типы политик](#типы-политик)  
  - [Validation Policies](#validation-policies)  
  - [Mutation Policies](#mutation-policies)  
  - [Enforcement Policies](#enforcement-policies)  
- [Где применяются политики](#где-применяются-политики)  
- [OPA Gatekeeper vs Kyverno](#opa-gatekeeper-vs-kyverno)  
  - [OPA Gatekeeper](#opa-gatekeeper)  
  - [Kyverno](#kyverno)  
  - [Почему не один инструмент](#почему-не-один-инструмент)  
- [Policy Lifecycle](#policy-lifecycle)  
- [Versioning политик](#versioning-политик)  
- [Rollout стратегия](#rollout-стратегия)  
- [Policy Drift и его предотвращение](#policy-drift-и-его-предотвращение)  
- [Связь с admission control](#связь-с-admission-control)  
- [Связь со структурой репозитория](#связь-со-структурой-репозитория)  
- [Инварианты policy-стратегии](#инварианты-policy-стратегии)  
- [Не-цели стратегии](#не-цели-стратегии)  
- [Итог](#итог)

---

# Назначение Policy Strategy

`policy-strategy.md` описывает **стратегию применения security-политик** в Kubernetes-платформе Sovereign AI.

Документ отвечает на вопросы:
- какие типы политик используются;
- где именно они применяются;
- почему используются несколько policy engines;
- как политики эволюционируют без нарушения инвариантов.

Архитектура задаёт требования.  
Этот документ описывает **механизм их принуждения**.

---

# Базовый принцип

Политики:
- обязательны;
- исполняемы автоматически;
- версионируемы;
- применяются до запуска workload’ов.

Advisory-политик не существует.  
Если правило не enforce’ится — его нет.

---

# Типы политик

## Validation Policies

Назначение:
- проверка соответствия требованиям;
- запрет небезопасных конфигураций.

Примеры:
- privileged containers;
- missing securityContext;
- отсутствие labels или annotations.

Результат:
- объект либо принимается, либо отклоняется.

---

## Mutation Policies

Назначение:
- автоматическое приведение объектов к допустимому виду;
- снижение когнитивной нагрузки на разработчиков.

Примеры:
- добавление seccomp profile;
- установка readOnlyRootFilesystem;
- нормализация labels.

Mutation никогда не ослабляет безопасность.

---

## Enforcement Policies

Назначение:
- закрепление архитектурных инвариантов;
- предотвращение drift’а.

Примеры:
- запрет обхода baseline;
- обязательные network policies;
- запрет ручных исключений.

Enforcement — последний арбитр.

---

# Где применяются политики

Политики применяются:
- на admission этапе;
- при каждом изменении состояния;
- одинаково во всех средах.

Нет “мягкого режима” для prod.  
Dev и stage не имеют сниженных требований.

---

# OPA Gatekeeper vs Kyverno

Используются **оба** инструмента намеренно.

## OPA Gatekeeper

Роль:
- строгий deny;
- формализация non-negotiable правил;
- соответствие compliance требованиям.

Используется для:
- архитектурных запретов;
- compliance-критичных контролей;
- cluster-wide инвариантов.

---

## Kyverno

Роль:
- mutation;
- guardrails;
- developer-friendly политики.

Используется для:
- автоконфигурации securityContext;
- безопасных defaults;
- постепенного ужесточения требований.

---

## Почему не один инструмент

- OPA — строгий, декларативный, формальный;
- Kyverno — гибкий, удобный, Kubernetes-native.

Разделение снижает:
- сложность политик;
- риск ошибок;
- операционную нагрузку.

---

# Policy Lifecycle

Жизненный цикл политики:

1. Design  
2. Review  
3. CI validation  
4. Dry-run (опционально)  
5. Enforce  
6. Audit  
7. Iteration  

Каждый шаг фиксируется в Git.

---

# Versioning политик

Политики:
- версионируются как код;
- имеют историю изменений;
- связаны с compliance контролями.

Breaking changes:
- оформляются как отдельные PR;
- проходят stage-валидацию;
- rollout’ятся контролируемо.

---

# Rollout стратегия

Подход:
- сначала baseline;
- затем strict enforcement;
- без environment-specific послаблений.

Rollback:
- возможен только через Git;
- всегда оставляет audit trail.

---

# Policy Drift и его предотвращение

Drift считается инцидентом.

Митигируется:
- deny-by-default;
- GitOps моделью;
- запретом out-of-band изменений;
- CI policy checks.

---

# Связь с admission control

Policy strategy реализуется через admission pipeline.

Admission:
- точка принуждения;
- единый вход в кластер;
- последний шанс остановить нарушение.

Подробно: `docs/admission-control.md`

---

# Связь со структурой репозитория

Политики организованы по доменам:
- policy-engine/opa-gatekeeper;
- policy-engine/kyverno;
- environments/ для rollout.

Структура отражает **архитектуру**, а не инструменты.

Подробно: `docs/repository-structure.md`

---

# Инварианты policy-стратегии

Никогда не нарушаются:
- политики одинаковы во всех средах;
- исключения не делаются вручную;
- enforcement важнее удобства;
- audit обязателен.

---

# Не-цели стратегии

Стратегия не предусматривает:
- per-team кастомные правила;
- временные ослабления;
- ручное отключение политик;
- security waiver’ы без кода.

---

# Итог

Policy strategy:
- превращает требования безопасности в код;
- устраняет человеческий фактор;
- обеспечивает воспроизводимость;
- делает безопасность масштабируемой.

В Sovereign AI политика — это закон.  
И он исполняется автоматически.
